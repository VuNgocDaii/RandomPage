<div class="container">
  <h1 class="title">RANDOM</h1>

  <div class="group-container">
    <!-- gr A -->
    <div class="group">
      <h3>Group A</h3>

      <div class="add-box">
        <input #doctorNameA type="text" placeholder="Nhập tên bác sĩ..." />
        <button (click)="confirmAdd(doctorNameA,'gra')">Thêm</button>
        <button class="multi-btn" (click)="openPopup('gra')">Thêm nhiều</button>
      </div>

      <div class="list-box">
        <div class="list-toolbar">
          <label class="checkbox-all">
            <input type="checkbox" [checked]="isAllChecked('gra')" (change)="toggleAll($event,'gra')" />
            Chọn tất cả
          </label>

          <div class="toolbar-actions">
            <button class="btn-del" (click)="confirmDeleteSelected('gra')">
              Xóa đã chọn
            </button>
            <button class="btn-del danger" (click)="confirmDeleteAll('gra')">
              Xóa tất cả
            </button>
          </div>
        </div>

        <ul>
          @for (item of groupA; track item.doctorId) {
          <li class="doc-item">
            @if (isEditing(item, 'gra')) {
            <input class="doc-edit-input" [(ngModel)]="editingName" [ngModelOptions]="{ standalone: true }"
              (keydown.enter)="confirmSaveEdit(`cur`)" (keydown.escape)="cancelEdit()" autofocus />

            <div class="doc-actions">
              <button class="btn-save" (click)="confirmSaveEdit(`cur`)">Lưu</button>
              <button class="btn-cancel" (click)="cancelEdit()">Hủy</button>
            </div>
            } @else {
            <input type="checkbox" class="row-checkbox" [(ngModel)]="item.selected"
              [ngModelOptions]="{ standalone: true }" />

            <span class="doc-name">{{ item.doctorName }}</span>

            <div class="doc-actions">
              <button class="btn-edit" (click)="startEdit(item,'gra')">Edit</button>
              <button class="btn-del" (click)="confirmDelete(item,'gra')">Xóa</button>
            </div>
            }
          </li>
          }
        </ul>
      </div>
    </div>

    <!--  gr B-->
    <div class="group">
      <h3>Group B</h3>

      <div class="add-box">
        <input #doctorNameB type="text" placeholder="Nhập tên bác sĩ..." />
        <button (click)="confirmAdd(doctorNameB,'grb')">Thêm</button>
        <button class="multi-btn" (click)="openPopup('grb')">Thêm nhiều</button>
      </div>

      <div class="list-box">
        <div class="list-toolbar">
          <label class="checkbox-all">
            <input type="checkbox" [checked]="isAllChecked('grb')" (change)="toggleAll($event,'grb')" />
            Chọn tất cả
          </label>

          <div class="toolbar-actions">
            <button class="btn-del" (click)="confirmDeleteSelected('grb')">
              Xóa đã chọn
            </button>
            <button class="btn-del danger" (click)="confirmDeleteAll('grb')">
              Xóa tất cả
            </button>
          </div>
        </div>

        <ul>
          @for (item of groupB; track item.doctorId) {
          <li class="doc-item">
            @if (isEditing(item, 'grb')) {
            <input class="doc-edit-input" [(ngModel)]="editingName" [ngModelOptions]="{ standalone: true }"
              (keydown.enter)="confirmSaveEdit(`cur`)" (keydown.escape)="cancelEdit()" autofocus />

            <div class="doc-actions">
              <button class="btn-save" (click)="confirmSaveEdit(`cur`)">Lưu</button>
              <button class="btn-cancel" (click)="cancelEdit()">Hủy</button>
            </div>
            } @else {
            <input type="checkbox" class="row-checkbox" [(ngModel)]="item.selected"
              [ngModelOptions]="{ standalone: true }" />

            <span class="doc-name">{{ item.doctorName }}</span>

            <div class="doc-actions">
              <button class="btn-edit" (click)="startEdit(item,'grb')">Edit</button>
              <button class="btn-del" (click)="confirmDelete(item,'grb')">Xóa</button>
            </div>
            }
          </li>
          }
        </ul>
      </div>
    </div>
  </div>

  @if (haveRandomed === false) {
  <button class="go-btn" (click)="random()">GO</button>
  } @else {
  @if (curCase === '1') {
  <div class="result-box">
    <div class="result-header">
      <h3>KẾT QUẢ GHÉP</h3>
      <button class="reset-btn" (click)="confirmReset()">Reset</button>
    </div>

    <div class="result-columns">
      <div class="result-col">
        <ul>
          @for (item of resOfMatchingDone; track item.docA.doctorId) {
          <li>
            <strong>{{ item.docA.doctorName }}</strong>
            →
            <span>{{ item.docB?.doctorName }}</span>
          </li>
          }
        </ul>
      </div>

      <div class="result-col">
        <ul>
          @for (item of resOfMatchingFail; track item.docA.doctorId) {
          <li>
            <strong>{{ item.docA.doctorName }}</strong>
            →
            <span class="no-match">Không ghép</span>
          </li>
          }
        </ul>
      </div>
    </div>
  </div>
  }
  @else {
    <div class="result-box">
  <div class="result-header">
    <h3>KẾT QUẢ GHÉP</h3>
    <button class="reset-btn" (click)="confirmReset()">Reset</button>
  </div>

  <div class="case2-table">
    <div class="case2-row case2-head">
      <div class="case2-cell case2-a-head">Group A</div>
      <div class="case2-cell case2-b-head">Group B</div>
    </div>

    @for (item of resCase2; track item.docA.doctorId) {
      <div class="case2-row">
        <div class="case2-cell case2-a">
          <strong class="case2-a-name">{{ item.docA.doctorName }}</strong>
        </div>

        <div class="case2-cell case2-b">
          <ul class="case2-b-grid">
            @for (child of item.docB; track child.doctorId) {
              <li class="case2-b-item" title="{{ child.doctorName }}">
                {{ child.doctorName }}
              </li>
            }
          </ul>
        </div>
      </div>
    }
  </div>
</div>

  }
  }

  @if (showPopup) {
  <div class="popup-overlay" (click)="closePopup()">
    <div class="popup" (click)="$event.stopPropagation()">
      <h3>Thêm nhiều bác sĩ</h3>

      <textarea [(ngModel)]="bulkText" placeholder="Mỗi dòng là 1 bác sĩ
VD:
Nguyễn Văn A
Trần Văn B"></textarea>

      <div class="popup-actions">
        <button (click)="confirmBulkAdd()">Thêm</button>
        <button class="cancel" (click)="closePopup()">Hủy</button>
      </div>
    </div>
  </div>
  }

  @if (showConfirm) {
  <div class="confirm-overlay" (click)="closeConfirm()">
    <div class="confirm-modal" (click)="$event.stopPropagation()">
      <div class="confirm-head">
        <div class="confirm-icon" [class.danger]="confirmType==='danger'" [class.warning]="confirmType==='warning'">
        </div>

        <div class="confirm-titles">
          <h3>{{ confirmTitle }}</h3>
          <p>{{ confirmMessage }}</p>
        </div>
      </div>

      <div class="confirm-actions">
        <button class="btn-cancel" (click)="closeConfirm()">Hủy</button>
        <button class="btn-ok" [class.danger]="confirmType==='danger'" [class.warning]="confirmType==='warning'"
          (click)="onConfirmYes()">
          Đồng ý
        </button>
      </div>
    </div>
  </div>
  }

  @if (openWarning) {
  <div class="confirm-overlay" (click)="closeWarning()">
    <div class="confirm-modal" (click)="$event.stopPropagation()">
      <div class="confirm-head">
        <div class="confirm-icon" [class.danger]="confirmType==='danger'" [class.warning]="confirmType==='warning'">
        </div>

        <div class="confirm-titles" style="font-size: 15px;">
          <p style="font-weight: 700;">Vui lòng không để trống hoặc chỉ nhập dấu cách</p>
        </div>
      </div>

      <div class="confirm-actions">
        <button class="btn-ok" [class.danger]="confirmType==='danger'" [class.warning]="confirmType==='warning'"
          (click)="closeWarning()">
          Đồng ý
        </button>
      </div>
    </div>
  </div>
  }
</div>